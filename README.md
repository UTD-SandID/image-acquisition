# image-acquisition

## Overview
This React Native app captures images to expand the dataset for the Sand ID machine learning algorithm. To ensure accurate scaling, a coin must be included in the picture. Users can upload images to a server for processing and saving but need login credentials to do so. If uploading an image immediately after capture, the app sends the current location. Otherwise, the user can select images for upload and must manually enter coordinates.

On opening the app, the user is greeted by a welcome screen with instructions and a dropdown to select which coin they are using. After confirming, a camera page will open. On this page the user can take images and choose to retake, save, or send the image. There is an outline that the user should line up their coin with, ensuring the coin is at least as big as the outline. This outline scales with the coin type selected on the welcome page. The first time the page is opened the user will have to take a calibaration picture. If sending the image from this page, the current location of th device will be sent. When sending an image for the first time, the user will have to enter their login information into a dialog that automatically appears. This dialog will not disappear until something is entered. If the login was invalid, the images will not be sent and the user will have to enter credentials again next time they try to send.
There is also a button to open the gallery page. On this page the user can select up to 10 images to send, and they will have to enter the location coordinates for each image. The same login dialog is present as well. It is important to note that these images will be labeled with the coin type that is selected on the welcome screen, so only images using that coin should be selected. This is not good UX and can result in processing issues, so it is a priority to fix. 

## Details

### Camera Page
The camera page uses the expo-camera API. To enable camera functionality, the app requests camera and location permissions using async API calls and displays an error message if not recieved. The image has settings to capture EXIF metadata, limit compression, and use jpg file format. To reduce resource utilization, the camera unmounts when the page is not in the foreground. There are useEffects for all the information that needs to be updated for a new image and used for a POST: LatitudeValue, LongitudeValue, username and password, timestamp, coinValue, and metaData(from which location and timestamp are extracted). The useEffects ensure that these fields are up-to-date every time a new image is captured.

An asynchronous API call captures the current location in coordinates of the device when the image is taken, which is inserted into the image EXIF metadata. The timestamp of the image is extracted from the metadata and formatted to use in the filename alongside the username, ensuring each image on the backend server has a unique identifier. 

A dialog with text fields for username and password appears if the user has not entered the information before, and the fields are blank, when they try to send an image. Once the information is saved, the app tries to send the image with the fetch request. This allows them to capture and save images without logging in. It will not show if the app has the login information, and instead the image will silently be sent. Once the dialog is open, a save button calls a function to save the information. The close button calls a function that checks if text has been entered. If not, the dialog opens again and the cycle repeats. If something was saved then the function to send is called. 

### Coin Outline Scaling
Using the coin value from the welcome page and Hollow-Circle component, the outline scaling is calculated. The coint type is passed in through the navigation route and is assigned a decimal in inches on this page. The first time the camera page is opened, the user is prompted to take a calibration picture. The resolution information in pixels is extracted from this calibration imageâ€™s metadata to use in the calculation. The view width in pixels is also captured when it renders using onLayout. With the pixels per inch value defined by the processing algorithm, 750, the appropriate size of circle is calculated and displayed. This estimates the size of the coin at a distance from the camera that would ensure 750 pixels per inch for the coin in the image. This is necessary for the processing algorithm. 
Calculation: coin diameter in inch*(necessary pixels per inch/image resolution width)*width of view in pixels

### Fetch request
The send function is not called if all the necessary information is not ready. Once it is, it assembles the information into a blob object and makes a POST request. he content type is multipart/form-data, and the formdata includes image{uri, type, filename}, latitude, longitude, coin, and image uri. The blob object format is necessary in order to send the image. The header of the request contains the username and apssword encoded as base 64 for authentication at the server. The filename is created by combining the username and image timestamp with a .jpg extension. The server's response is parsed and checked for if the login credentials were invalid. If they were, they are set to blank and will be requested the next time the user tries to send. 

### Gallery Page
The gallery page allows users to select up to 10 images to send at once. Currently, all of the images must be using the same type of coin. The image uri's are added to a list and then looped through when trying to send an image. For each image, a page is opened to enter the lat and long coordinates when the user presses send. The same login dialog is utilized as well. In order to actually send the images, send has to be pressed again.
